'''scan_cve(base_url, log_file):

수집된 정보(서버 및 소프트웨어 버전)를 기반으로 CVE 데이터를 검색.
scan_http_methods(base_url, log_file):

서버가 지원하는 HTTP 메서드 점검 및 불필요한 메서드 식별.
scan_network_services(base_url, log_file):

네트워크 스캔을 통해 실행 중인 서비스와 취약점 분석.
scan_api_vulnerabilities(api_endpoints, log_file):

API 엔드포인트의 보안 점검 (SQL Injection, 인증 우회 등).
scan_upload_vulnerability(base_url, log_file):

파일 업로드 기능의 검증.
scan_directory_traversal(base_url, log_file):

Directory Traversal 공격 가능성 점검.'''

import requests
import os
import json

def load_config():
    json_file_name = os.path.join("config", "settings.json")
    absolute_path = os.path.abspath(json_file_name)

    try:
        with open(absolute_path, 'r', encoding='utf-8') as json_file:
            return json.load(json_file)
    except FileNotFoundError:
        print(f"[ERROR] JSON ")

def scan_http_methods(config, log_file):
    base_url = config.get("base_url")

    print("\n[INFO] Scanning HTTP Methods...")
    with open(log_file, 'a') as log:
        log.write("\n[INFO] Scanning HTTP Methods...\n")

        try:
            response = requests.options(base_url, timeout=5)
            if "Allow" in response.headers:
                allowed_methods = response.headers["Allow"].split(", ")
                print(f"[INFO] Supported HTTP Methods: {', '.join(allowed_methods)}")
                log.write(f"[INFO] Supported HTTP Methods: {', '.join(allowed_methods)}\n")

                for method in ["PUT", "DELETE", "TRACE", "OPTIONS"]:
                    if method in allowed_methods:
                        print(f"[WARNING] {method} method is enabled. This could be a security risk.")
                        log.write(f"[WARNING] {method} method is enabled. This could be a security risk.\n")
            else:
                print("[INFO] Server did not respond with an 'Allow' header.")
                log.write("[INFO] Server did not respond with an 'Allow' header.\n")
        except requests.RequestException as e:
            print(f"[ERROR] Failed to scan HTTP methods: {e}")
            log.write(f"[ERROR] Failed to scan HTTP methods: {e}\n")

def run_scan(log_file):
    config = load_config()
    if not config:
        return
    base_url = config.get("base_url")
    if not base_url:
        print("[ERROR] Base URL is not defined in the configuration file.")
        return
    
    scan_http_methods(config, log_file)